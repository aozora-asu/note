<!-- ---
theme: seriph
background: https://source.unsplash.com/collection/94734566/1920x1080
class: text-center
highlighter: shiki
info: |
  ## network
  Presentation slides for network.
transition: slide-left
title: \network
mdc: true
githubPages:
  ogp: true
lineNumbers: true
aspectRatio: 16/9
exportFilename: ''
favicon: https://cdn.jsdelivr.net/gh/slidevjs/slidev/assets/favicon.png
css: windicss
---

# Welcome to Slidev

Presentation slides for developers

<div class="pt-12">
  <span @click="$slidev.nav.next" class="px-2 py-1 rounded cursor-pointer" hover="bg-white bg-opacity-10">
    Press Space for next page <carbon:arrow-right class="inline"/>
  </span>
</div>

<div class="abs-br m-6 flex gap-2">
  <button @click="$slidev.nav.openInEditor()" title="Open in Editor" class="text-xl slidev-icon-btn opacity-50 !border-none !hover:text-white">
    <carbon:edit />
  </button>
  <a href="https://github.com/slidevjs/slidev" target="_blank" alt="GitHub" title="Open in GitHub"
    class="text-xl slidev-icon-btn opacity-50 !border-none !hover:text-white">
    <carbon-logo-github />
  </a>
</div> -->

---
4GBのUSBは3.7GBまでしか保存できない。ブロック、セクター、ページ単位で管理されるため、実際はこれよりも少し少ない
(4GBは10進数表記だが、実際にコンピュータ上で使われる容量はこれを2進数にキャストしたものだから)

# ネットワーク階層モデル、IPアドレス、ルーティングに関する詳細な解析

## 1. 階層モデル

### 1.1 OSI参照モデル
OSI（Open Systems Interconnection）参照モデルは、ネットワーク通信の標準的なフレームワークであり、以下の7つの層に分かれています。
1. **物理層 (Physical Layer)**: データを物理的に転送する層で、ケーブルやハードウェアインターフェースが関与します。
2. **データリンク層 (Data Link Layer)**: データの転送を管理し、エラーチェックやフレームの制御を行います。
3. **ネットワーク層 (Network Layer)**: パケット転送、ルーティング、IPアドレスによる宛先指定を行います。
4. **トランスポート層 (Transport Layer)**: データの信頼性を確保し、エラー訂正や再送制御を行います。
5. **セッション層 (Session Layer)**: 通信のセッション管理を行い、接続の確立、維持、終了を管理します。
6. **プレゼンテーション層 (Presentation Layer)**: データの表現形式（エンコーディングや圧縮）を定義します。
7. **アプリケーション層 (Application Layer)**: ユーザーに最も近い層で、アプリケーションやサービスが動作します。

### 1.2 TCP/IPモデル
TCP/IPモデルは、ネットワーク通信のスタックを4層で表現します。以下の4層構造です。
1. **リンク層 (Link Layer)**: OSIモデルの物理層とデータリンク層に相当し、データ転送のためのメカニズムを提供します。
2. **インターネット層 (Internet Layer)**: OSIモデルのネットワーク層に相当し、IPアドレスを用いたルーティングとデータ転送を管理します。
3. **トランスポート層 (Transport Layer)**: OSIモデルと同じ機能を提供し、データ通信の信頼性と順序を管理します。
4. **アプリケーション層 (Application Layer)**: ユーザーインターフェースやアプリケーションデータの伝送を行います。

## 2. IPアドレス

### 2.1 IPアドレスの基本
IPアドレスは、ネットワーク上の各デバイスを一意に識別するために使用される数値です。IPアドレスにはIPv4とIPv6があり、それぞれの形式と構造に違いがあります。

#### IPv4アドレス
IPv4アドレスは32ビットで構成され、通常はドットで区切られた4つのオクテット（8ビット）で表示されます。
例: `192.168.1.1`

IPv4アドレスは以下の4つの部分から構成されます。
- **ネットワーク部**: ネットワークを識別する部分。
- **ホスト部**: ネットワーク内の特定のホストを識別する部分。
- **サブネット部**: サブネット化されたネットワーク内でのホストを識別する部分。
- **ブロードキャストアドレス**: 同一ネットワーク内のすべてのホストに向けたメッセージを送信するアドレス。

#### IPv6アドレス
IPv6アドレスは128ビットで構成され、16ビットごとにコロンで区切られます。
例: `2001:0db8:85a3:0000:0000:8a2e:0370:7334`

### 2.2 サブネット化
サブネット化は、IPアドレス空間を効率的に使用するために、ネットワークを細かく分割する技術です。サブネットマスクを用いてネットワーク部とホスト部を識別し、サブネットを作成します。
- **サブネットマスク**: IPアドレスのネットワーク部分とホスト部分を区別するためのビットマスク。例: `255.255.255.0`

### 2.3 クラスフルとクラスレス
IPアドレスは、もともとクラスフルなアドレス設計が用いられていましたが、クラスレス（CIDR）によりより柔軟にアドレスを割り当てることが可能になりました。CIDR（Classless Inter-Domain Routing）では、ネットワークのスラッシュ表記（例：`192.168.1.0/24`）を使用します。

#### クラスフルアドレス
- **クラスA**: `0.0.0.0` ～ `127.255.255.255`（1～127番の最初のビットが0）
- **クラスB**: `128.0.0.0` ～ `191.255.255.255`（最初のビットが10）
- **クラスC**: `192.0.0.0` ～ `223.255.255.255`（最初のビットが110）

#### クラスレスアドレス
CIDR（Classless Inter-Domain Routing）方式では、IPアドレスに対して柔軟なサブネットマスクを適用でき、ネットワークの効率的な運用が可能です。CIDR表記は `/` を使い、例えば `192.168.1.0/24` のように記述されます。

## 3. ルーティング

### 3.1 ルーティングの基本
ルーティングは、ネットワーク上のパケットが適切な宛先に届くように経路を決定するプロセスです。ルータは、パケットを転送する際にどの経路を選ぶべきかを決定します。

### 3.2 ルーティングテーブル
ルーティングテーブルは、ネットワークデバイス（通常はルータ）がどの経路を使用すべきかを決定するための情報を持つデータベースです。各エントリは以下を含みます。
- **宛先ネットワークアドレス**
- **サブネットマスク**
- **次ホップアドレス**
- **インターフェース情報**

### 3.3 ルーティングプロトコル
ルーティングプロトコルは、ルータ同士で経路情報を交換し、ルーティングテーブルを更新するための規則を定めたプロトコルです。主なものには以下のようなプロトコルがあります。

#### スタティックルーティング
スタティックルーティングでは、ネットワーク管理者が手動で経路を設定します。小規模なネットワークや変化の少ないネットワークにおいて使用されます。

#### ダイナミックルーティング
ダイナミックルーティングでは、ルータが経路情報を自動的に交換し、ネットワークの状態に応じて最適な経路を選択します。主要なダイナミックルーティングプロトコルには以下があります。
- **RIP（Routing Information Protocol）**: 距離ベースのルーティングプロトコルで、経路のホップ数で最適経路を決定します。
- **OSPF（Open Shortest Path First）**: リンク状態型のルーティングプロトコルで、経路選択にDijkstraアルゴリズムを使用します。
- **BGP（Border Gateway Protocol）**: 経路選択のためのポリシーベースのルーティングプロトコルで、インターネット上で広く使用されています。

### 3.4 ルーティング最適化
ルーティング最適化には、トラフィックの効率化、冗長経路の設定、負荷分散が含まれます。これにより、ネットワークのパフォーマンスを向上させ、障害発生時にも柔軟に対応できます。

### 3.5 負荷分散と冗長性
負荷分散は、複数の経路を通じてトラフィックを均等に分配し、ネットワーク全体の効率を向上させます。また、冗長経路を設定することで、障害が発生した際 &#8203;:contentReference[oaicite:0]{index=0}&#8203;

にバックアップ経路を利用して、ネットワークの可用性を確保します。

#### 負荷分散
負荷分散は、複数の経路を活用してトラフィックを効率的に分配する技術です。これにより、ネットワークのスループットが向上し、一部の経路にトラフィックが集中して障害が発生するリスクを軽減できます。特に、複数のプロバイダーが提供するインターネット接続を利用する場合や、大規模なデータセンターの内部ネットワークで活用されます。

#### 冗長性
冗長性は、ネットワークの可用性を高めるために、重要な経路や機器を複数用意することです。これにより、障害が発生してもネットワークが途絶えることなく、サービスを継続することができます。例えば、異なるデータセンターに複数のインターネット接続を持つことが冗長性の一例です。

## 4. ネットワークアドレス変換 (NAT)

### 4.1 NATの基本
NAT（Network Address Translation）は、プライベートネットワーク内のIPアドレスを、インターネット上のパブリックIPアドレスに変換する技術です。これにより、IPアドレスの節約が可能になり、セキュリティの向上にもつながります。

#### プライベートIPとパブリックIP
プライベートIPアドレスは、インターネット上で一意でないアドレス空間であり、内部ネットワークで使用されます。これに対し、パブリックIPアドレスはインターネット上で一意に識別されるアドレスです。NATを利用することで、内部のプライベートIPアドレスを一つのパブリックIPに変換し、外部ネットワークとの通信を実現します。

#### NATの種類
NATにはいくつかのタイプがありますが、主要なものは以下の通りです。
- **スタティックNAT**: 固定された1対1のマッピングを行います。内部IPと外部IPが一対一で対応するため、通信が常に同じIPアドレスで行われます。
- **ダイナミックNAT**: 内部IPアドレスを、事前に設定されたパブリックIPアドレスのプールから動的に割り当てます。外部のネットワークにアクセスする際、使用するパブリックIPアドレスは異なる場合があります。
- **ポートアドレス変換 (PAT)**: 複数の内部IPアドレスが1つのパブリックIPアドレスを共有するため、ポート番号を使用してセッションごとに一意に識別します。これは、家庭や企業のネットワークで最も一般的に使用されるNATの形式です。

### 4.2 NATの利点と課題
#### 利点
- **IPアドレスの節約**: NATを使うことで、限られたパブリックIPアドレスを効率的に活用できます。
- **セキュリティの向上**: NATは、内部ネットワークと外部ネットワークを分離し、外部からの直接的なアクセスを防ぐため、セキュリティを強化します。

#### 課題
- **トラブルシューティングの難易度**: NATが施されたネットワークでは、パケットのトラッキングが複雑になり、問題解決が難しくなる場合があります。
- **アプリケーションの互換性**: 一部のアプリケーション（特にP2P通信など）は、NATをうまく利用できず、通信に問題が生じることがあります。

## 5. サービス提供のためのネットワーク設計

### 5.1 ネットワークの冗長性
サービス提供においてネットワークの冗長性は非常に重要です。冗長性を確保するために、ネットワークにおいて複数の経路や機器を用意し、単一障害点（SPOF）を排除することが推奨されます。冗長化されたネットワークでは、障害が発生しても他の経路が利用可能であるため、サービスの継続性が保たれます。

### 5.2 パフォーマンスの最適化
ネットワークのパフォーマンスを最適化するためには、トラフィックの流れを効率的に管理し、帯域幅を最大限に活用する必要があります。負荷分散やトラフィックの優先順位設定、QoS（Quality of Service）を活用することで、重要なデータが優先的に処理されるようにします。

### 5.3 セキュリティの確保
ネットワークセキュリティは、サービス提供において欠かせない要素です。ファイアウォール、VPN（Virtual Private Network）、IDS/IPS（Intrusion Detection/Prevention Systems）などの技術を導入することで、ネットワークを外部の攻撃から保護します。また、アクセス制御リスト（ACL）を使用して、アクセス権限を厳密に管理します。

### 5.4 スケーラビリティ
スケーラビリティは、サービスの需要が増加した際に、ネットワークが適切に対応できる能力を指します。スケーラブルなネットワーク設計では、必要に応じてリソースを追加することが可能であり、成長に伴ってネットワークを簡単に拡張できることが求められます。

## 6. まとめ
ネットワーク階層モデル、IPアドレス、ルーティングなどの基礎を理解することで、効率的なネットワーク設計と運用が可能になります。特に、NATや冗長化、セキュリティ対策など、サービス提供のための具体的な設計と運用には、これらの基本的な技術が不可欠です。ネットワークの最適化とスケーラビリティを考慮しつつ、可用性とセキュリティを確保することが、安定したサービス提供には重要です。


<!--
The last comment block of each slide will be treated as slide notes. It will be visible and editable in Presenter Mode along with the slide. [Read more in the docs](https://sli.dev/guide/syntax.html#notes)
-->

# IPアドレスのクラス、サブネット、可変長サブネットマスク、ホップ数について

## 1. IPアドレスのクラス

IPアドレスは、インターネットプロトコルで使用される32ビットのアドレスで、ネットワーク上でホストを一意に識別するために使用されます。IPアドレスは、ネットワーク部分とホスト部分に分かれており、アドレスの最初のビットによってクラスが決まります。IPアドレスのクラスは、以下の通りに分類されます。

### クラスA
- **範囲**: 1.0.0.0 ～ 126.0.0.0
- **デフォルトマスク**: 255.0.0.0 (/8)
- **特徴**: 
  - 1ビット目が0
  - 大規模なネットワーク用
  - 約1億6千万のホストを持つネットワークを作成可能

### クラスB
- **範囲**: 128.0.0.0 ～ 191.255.0.0
- **デフォルトマスク**: 255.255.0.0 (/16)
- **特徴**: 
  - 1ビット目が1で、2ビット目が0
  - 中規模なネットワーク用
  - 約65,000のホストを持つネットワークを作成可能

### クラスC
- **範囲**: 192.0.0.0 ～ 223.255.255.0
- **デフォルトマスク**: 255.255.255.0 (/24)
- **特徴**: 
  - 最初の3ビットが110
  - 小規模なネットワーク用
  - 最大254ホストを持つネットワークを作成可能

### クラスD
- **範囲**: 224.0.0.0 ～ 239.255.255.255
- **用途**: マルチキャスト

### クラスE
- **範囲**: 240.0.0.0 ～ 255.255.255.255
- **用途**: 予約アドレス、実験用

---

## 2. サブネット

サブネットは、ネットワークを小さな部分に分割する技術です。これにより、ネットワーク管理の効率が向上し、セキュリティが向上することがあります。IPアドレスのネットワーク部分を拡張し、ホスト部分を減らすことで、より多くのサブネットを作成できます。

### サブネットマスク
サブネットマスクは、ネットワーク部分とホスト部分を区別するために使用される32ビットの数値です。例えば、クラスCのデフォルトサブネットマスクは 255.255.255.0 で、前24ビットがネットワーク部分、後8ビットがホスト部分です。ネットワークをさらに細かく分割するには、サブネットマスクを変更することができます。例えば、255.255.255.128 (/25) であれば、クラスCのネットワークを2つに分割できます。

### サブネットの計算例
クラスCのネットワーク 192.168.1.0/24 を4つに分割する場合のサブネットマスクは 255.255.255.192 (/26) になります。この場合、各サブネットには64個のIPアドレスが割り当てられますが、そのうち2つはネットワークアドレスとブロードキャストアドレスとして予約されます。

---

## 3. 可変長サブネットマスク (VLSM)

VLSM (Variable Length Subnet Mask) は、異なるサイズのサブネットを使用して、ネットワークアドレス空間を効率的に活用する手法です。従来の固定長サブネットマスクでは、すべてのサブネットに同じサブネットマスクを使用していましたが、VLSMでは必要に応じて異なるサブネットマスクを使用できます。

### VLSMの利点
- **アドレス空間の効率的利用**: ネットワークの規模に合わせて異なるサイズのサブネットを作成できるため、無駄なアドレスの浪費を防げます。
- **柔軟な設計**: VLSMを使用すると、異なるサイズのサブネットを持つ複雑なネットワーク構造を構築できます。

### VLSMの例
例えば、ネットワーク 192.168.1.0/24 をVLSMで分割する場合、次のようにサブネットを構成できます。
1. 大規模なサブネット（192.168.1.0/25）: 126ホスト
2. 中規模なサブネット（192.168.1.128/26）: 62ホスト
3. 小規模なサブネット（192.168.1.192/27）: 30ホスト

---

## 4. ホップ数

### ホップ数の定義
ホップ数は、ネットワーク上のパケットが目的地に到達するまでに通過するルーターの数を指します。1つのホップは、パケットがルーターから別のルーターに転送されることを表します。

### ホップ数の役割
ホップ数は、ネットワークパフォーマンスの評価やルーティングプロトコルで重要な役割を果たします。例えば、ルーティングプロトコルでは、最短ホップ数のルートを選択することが一般的です。ホップ数が少ない経路を選択することで、ネットワークの遅延を最小限に抑えることができます。

### TTL (Time To Live)
IPパケットにはTTL（生存時間）というフィールドがあり、パケットが通過するルーターごとに1ずつ減少します。TTLが0になると、パケットは破棄されます。これにより、ループによる無限ルーティングを防ぐことができます。通常、ホップ数の制限が50から70ホップに設定されることが多いです。

---

## 5. サブネット化とVLSMの具体的な活用例

以下は、企業ネットワークのサブネット化とVLSMの具体的な例です。

### 例: VLSMを使ったネットワーク設計
1. 本社（100台のデバイス）
   - ネットワーク: 192.168.1.0/25
   - 利用可能ホスト: 126台

2. 支社A（30台のデバイス）
   - ネットワーク: 192.168.1.128/26
   - 利用可能ホスト: 62台

3. 支社B（15台のデバイス）
   - ネットワーク: 192.168.1.192/27
   - 利用可能ホスト: 30台

このように、VLSMを活用することで、ネットワークの規模に応じた効率的なサブネットの設計が可能になります。必要に応じて異なるサブネットマスクを適用することで、リソースの最適化とネットワークの柔軟性を向上させることができます。

---

## 6. まとめ

IPアドレスのクラス、サブネット、VLSM、ホップ数は、ネットワーク設計と運用において重要な要素です。特に、大規模なネットワークやインターネット接続を含む複雑なネットワーク環境では、これらの知識が不可欠です。効果的なネットワークの運用と管理を行うために、これらの概念を理解し、適切に活用することが求められます。


# ホップ数とアドレスの結合について

## 1. ホップ数

ホップ数は、ネットワーク上でパケットが送信元から目的地に到達するまでに通過するルーターの数を指します。ネットワークルーティングにおいて重要な役割を果たし、データの伝送経路やネットワークの効率性を評価する際の基本的な指標です。

### 1.1 ホップ数の概要
- **ルーターの役割**: ホップ数のカウントは、パケットが各ルーターを通過するたびに増加します。ルーターはネットワーク間を中継する役割を持ち、パケットの経路を選択することで、最適な通信経路を確保します。
- **経路選択とホップ数**: ホップ数が少ない経路は、通常、データ伝送がより迅速であるとされます。ルーティングプロトコルは、最短ホップ数の経路を選択することが一般的です。ただし、最短経路が常に最適とは限らず、遅延、帯域幅、品質の面でも考慮することが重要です。

### 1.2 ホップ数の使用例
- **Tracerouteコマンド**: トラブルシューティングにおいて、ホップ数を確認するために使用される一般的なツールが `traceroute`（Windowsでは `tracert`）コマンドです。これにより、パケットが通過するすべてのホップ（ルーター）を特定でき、経路の遅延や障害の原因を特定する際に役立ちます。
  ```shell
  traceroute example.com


これにより、example.comへの経路に存在するホップのリストと各ホップでの応答時間が表示されます。

1.3 TTL (Time To Live) とホップ数の関連
IPパケットにはTTL（Time To Live）フィールドが存在し、パケットが通過するたびにホップ数が1減少します。TTLが0になると、パケットは破棄され、送り元にエラーメッセージ（ICMPの「時間超過」メッセージ）が返されます。これにより、ループの発生を防ぎ、無限にネットワークを巡回するパケットを防止します。

1.4 ホップ数の重要性
ルーティングの効率化: 最短ホップ数の経路を選ぶことで、パケットの遅延を減少させ、ネットワークの効率を向上させます。
ネットワークの障害特定: トラブルシューティングの際に、どのルーターで問題が発生しているのかを特定するのに役立ちます。
パフォーマンスの最適化: パケットの行き先までの経路を選定する際にホップ数を考慮することで、通信のパフォーマンスを最適化できます。
2. アドレスの結合（サブネットの集約）
アドレスの結合（サブネットの集約、またはCIDR: Classless Inter-Domain Routing）は、複数のIPアドレスブロックを一つの大きなアドレスブロックにまとめる手法です。これにより、ルーティングテーブルのサイズを小さくし、ネットワークの管理を簡素化することが可能です。

2.1 CIDR（Classless Inter-Domain Routing）とは
従来のクラスベースのアドレッシングの問題点: クラスA、クラスB、クラスCなどの固定サイズのネットワークでは、アドレスの浪費が発生しやすく、特にインターネットの初期の頃は、大規模なネットワークを構築すると大量のアドレスが無駄になっていました。
CIDRの導入: CIDRは、任意のサイズのネットワークを作成することを可能にし、柔軟なアドレスの割り当てが可能になりました。これにより、ネットワークを効率的に管理できます。CIDR表記では、IPアドレスの後ろにスラッシュ（/）とビット数を記述します。たとえば、192.168.0.0/22は、192.168.0.0 ～ 192.168.3.255までのアドレス範囲を示します。
2.2 アドレスの結合の例
複数の連続するIPアドレスを一つにまとめることで、ルーティングテーブルのサイズを縮小します。

例: 次の4つのクラスCネットワークを一つに結合する場合を考えます。
192.168.0.0/24
192.168.1.0/24
192.168.2.0/24
192.168.3.0/24
これらは、CIDR表記で 192.168.0.0/22 として一つにまとめることが可能です。これにより、ルーティングテーブルには1つのエントリで十分となり、管理の負担を軽減します。
2.3 サブネットの集約の利点
ルーティングテーブルの簡素化: 複数のネットワークアドレスをまとめることで、ルーティングエントリが削減され、ルーターのパフォーマンスが向上します。
アドレスの効率的利用: 必要なアドレス数に応じたサブネットを柔軟に作成できるため、アドレスの浪費を最小限に抑えることができます。
2.4 可変長サブネットマスク（VLSM）との関連
CIDRは、VLSMの基礎でもあります。VLSMでは、ネットワーク内で異なるサブネットマスクを使用して、必要なホスト数に応じてアドレスを分割することができます。これにより、ネットワーク全体をより細かく制御し、必要に応じてネットワークを最適化できます。

3. まとめ
ホップ数: ネットワーク上でのパケットのルートを把握する上で重要な概念であり、経路の効率性やトラブルシューティングの基本的な指標です。
アドレスの結合: CIDRによるアドレスの集約により、ルーティングテーブルのサイズを小さくし、ネットワーク管理の効率を向上させます。VLSMも活用して、アドレスの無駄を防ぐ設計を行うことが重要です。